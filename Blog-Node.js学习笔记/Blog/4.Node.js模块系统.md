# 模块系统

> 在计算机程序的开发过程中，随着程序代码越写越多，在一个文件里代码就会越来越长，越来越不容易维护。

> 为了编写可维护的代码，我们把很多函数分组，分别放到不同的文件里，这样，每个文件包含的代码就相对较少，很多编程语言都采用这种组织代码的方式。在Node环境中，一个.js文件就称之为一个模块（module）。

## 使用模块有什么好处？

**最大的好处是大大提高了代码的可维护性。其次，编写代码不必从零开始。当一个模块编写完毕，就可以被其他地方引用。我们在编写程序的时候，也经常引用其他模块，包括Node内置的模块和来自第三方的模块。**

## 在Node中，模块分为三种。
 * 具名的核心模块，如：fs、http等。
 * 用户自己编写的文件模块（JS文件）。
 * 第三方模块。 
   - art-template
   - 通过npm下载的
   
##  Node中没有全局作用域，只有模块作用域。
 * 外部访问不到内部，内部访问不到外部。


# 加载 

```js
var 自定义变量名称 = require('模块')
```
两个作用：
 * 加载文件模块，并执行里面的代码。
 * 拿到被加载的文件模块导出的接口对象。
 
## require中的相对路径必须加 `./`，不可省略
 * 可以省略后缀名
 * 相对路径
 如果你只写文件名，则Node会依次在内置模块、全局模块和当前模块下查找`hello.js`，你很可能会得到一个错误：
 ```
 module.js
    throw err;
          ^
Error: Cannot find module 'hello'
    at Function.Module._resolveFilename
    at Function.Module._load
    ...
    at Function.Module._load
    at Function.Module.runMain
```
遇到这个错误，你要检查：

 - 模块名是否写对了；
 - 模块文件是否存在；
 - 相对路径是否写对了。
 
 ## require加载规则
 
我们先来看一个例子:
<img src="https://raw.githubusercontent.com/webbj97/summary/master/Images/NodeImg/4-2.jpg" alt="">

# 导出
- Node中是模块作用域 ，默认文件中的所有成员指在当前文件中有效。
 * 所有每个文件模块中都提供了一个对象： `exports`。它是是一个默认空对象。 
 * 对于希望可以访问的模块成员，需要将其挂载到`exports`接口对象中即可（成为它的一个属性）。
 
### 第一种方法 （导出多个成员）
```js
exports.foo = 123;
exports.add = function (x, y) {
    return x + y;
};
exports.c = 'hello';
exports.d = {name: 'jace',age : 21}
```

这里有一个特殊的地方，如果我只希望a可以拿到b里声明的函数add，我可不可以 在b中写成 `exports = add` 呢？

答案是否定的，此时我们又引出了第二个导出（暴露）方法。


### 第二种方法 (导出单个成员 例如：字符串、函数)
> 如果某个模块需要直接导出某个成员，而非挂载的方式，我们必须使用 `module.exports = add` 的方式。

```js
module.exports = add;
```
**注意！ 以下情况会覆盖 **

```js
module.exports = 'hello';
module.exports = function(){} //后者会覆盖前者
```

### exports 和 module.exports的区别

> 因为本人也是第一次接触Node，且也是第一次接触服务端，总结的不到位的请多指正。

- 每一个模块中都有一个 module 对象
- module 对象中有一个 exports 对象
- 我们可以把需要导出的成员都 **挂载** 到 module.exports 接口对象中。
- 起初的挂载方式 `module.exports.xxx = xxx` 较麻烦，Node为了开发者的考虑，在每个模块中提供了一个成员叫 `exports`
 + `exports === module.exports` return true
- **注意** 当一个模块需要导出单个成员时，必须使用 `module.exports = xxx` 的方式
- `exports = xxx` 这样的方法是无效的，exports仅仅是module.exports的引用，你对exports赋值，对最终结果没有影响。
- 如果你非要这么做， 你可以添加 `exports = module.exports` 这个用来重新建立引用关系、

例如： 
```js
module.exports = {
   a: 123
}//第一条

exports = module.exports //第三条 (此时 第二条生效) //结果为exports = {a: 123, foo: bar}

exports.foo = 'bar // 第二条（此时它无效）

```


## CommonJS模块规范
在Node中的JavaScript还有一个很重要的概念：模块系统。
* 模块作用域。
* 使用`require`方法用来加载模块。
* 使用`exports`对象来导出模块。

